/*! ng-csv 25-04-2015 */
(function(){angular.module("ngCsv.config",[]).value("ngCsv.config",{debug:!0}).config(["$compileProvider",function(n){angular.isDefined(n.urlSanitizationWhitelist)?n.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/):n.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]);angular.module("ngCsv.directives",["ngCsv.services"]);angular.module("ngCsv.services",[]);angular.module("ngCsv",["ngCsv.config","ngCsv.services","ngCsv.directives","ngSanitize"]);angular.module("ngCsv.services").service("CSV",["$q",function(n){var t="\r\n",r="ï»¿",i={"\\t":"\t","\\b":"\b","\\v":'\v',"\\f":"\f","\\r":"\r"};this.stringifyField=function(n,t){return t.decimalSep==="locale"&&this.isFloat(n)?n.toLocaleString():t.decimalSep!=="."&&this.isFloat(n)?n.toString().replace(".",t.decimalSep):typeof n=="string"?(n=n.replace(/"/g,'""'),(t.quoteStrings||n.indexOf(",")>-1||n.indexOf("\n")>-1||n.indexOf("\r")>-1)&&(n=t.txtDelim+n+t.txtDelim),n):typeof n=="boolean"?n?"TRUE":"FALSE":n};this.isFloat=function(n){return+n===n&&(!isFinite(n)||Boolean(n%1))};this.stringify=function(i,u){var f=n.defer(),s=this,e="",o="",h=n.when(i).then(function(n){var h,c,i;angular.isDefined(u.header)&&u.header&&(h=[],angular.forEach(u.header,function(n){this.push(s.stringifyField(n,u))},h),c=h.join(u.fieldSep?u.fieldSep:","),o+=c+t);i=[];angular.isArray(n)?i=n:angular.isFunction(n)&&(i=n());angular.forEach(i,function(n,r){var h=angular.copy(i[r]),f,e;e=[];angular.forEach(h,function(n){this.push(s.stringifyField(n,u))},e);f=e.join(u.fieldSep?u.fieldSep:",");o+=r<i.length?f+t:f});u.addByteOrderMarker&&(e+=r);e+=o;f.resolve(e)});return typeof h["catch"]=="function"&&h["catch"](function(n){f.reject(n)}),f.promise};this.isSpecialChar=function(n){return i[n]!==undefined};this.getSpecialChar=function(n){return i[n]}}]);angular.module("ngCsv.directives").directive("ngCsv",["$parse","$q","CSV","$document","$timeout",function(n,t,i){return{restrict:"AC",scope:{data:"&ngCsv",filename:"@filename",header:"&csvHeader",txtDelim:"@textDelimiter",decimalSep:"@decimalSeparator",quoteStrings:"@quoteStrings",fieldSep:"@fieldSeparator",lazyLoad:"@lazyLoad",addByteOrderMarker:"@addBom",ngClick:"&",charset:"@charset"},controller:["$scope","$element","$attrs","$transclude",function(n,r,u){function f(){var t={txtDelim:n.txtDelim?n.txtDelim:'"',decimalSep:n.decimalSep?n.decimalSep:".",quoteStrings:n.quoteStrings,addByteOrderMarker:n.addByteOrderMarker};return angular.isDefined(u.csvHeader)&&(t.header=n.$eval(n.header)),t.fieldSep=n.fieldSep?n.fieldSep:",",t.fieldSep=i.isSpecialChar(t.fieldSep)?i.getSpecialChar(t.fieldSep):t.fieldSep,t}n.csv="";angular.isDefined(n.lazyLoad)&&n.lazyLoad=="true"||angular.isArray(n.data)&&n.$watch("data",function(){n.buildCSV()},!0);n.getFilename=function(){return n.filename||"download.csv"};n.buildCSV=function(){var e=t.defer();return r.addClass(u.ngCsvLoadingClass||"ng-csv-loading"),i.stringify(n.data(),f()).then(function(t){n.csv=t;r.removeClass(u.ngCsvLoadingClass||"ng-csv-loading");e.resolve(t)}),n.$apply(),e.promise}}],link:function(n,t){function i(){var t=n.charset||"utf-8",i=new Blob([n.csv],{type:"text/csv;charset="+t+";"});saveAs(i,n.getFilename())}t.bind("click",function(){n.buildCSV().then(function(){i()});n.$apply()})}}}])})(window,document);
